<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mucha manual • mucha</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mucha manual">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mucha</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">mucha manual</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vbonhomme/mucha/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mucha manual</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vbonhomme/mucha/blob/main/vignettes/articles/intro.Rmd" class="external-link"><code>vignettes/articles/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="foreword">Foreword<a class="anchor" aria-label="anchor" href="#foreword"></a>
</h2>
<p><code>mucha</code> implements a simple workflow for
<em>mu</em>ltiscale <em>c</em>omparison and <em>h</em>eterogeneity
<em>a</em>nalyses.</p>
<p>Put briefly, the idea is to obtain a summary statistic for all pixels
of a single (MHM) or two (CMP) landscapes, using a moving window
approach, and for with a varying window size. Then composite map and
profile plot are calculated, so that multiscale patterns can be
detected, analysed and displayed.</p>
<p>The primary goal of the CMP R package is to port the <a href="https://amap-dev.cirad.fr/projects/MHM" class="external-link">MHM</a> and <a href="https://amap-dev.cirad.fr/projects/CMP" class="external-link">CMP</a> softwares by
Gaucherel and colleagues to R.</p>
<p>These softwares were written in Java and are no longer
maintained.</p>
<p>This R port is a thin wrapper on top of the excellent <a href="https://cran.r-project.org/web/packages/terra/index.html" class="external-link">terra</a>
package and notably <a href="https://search.r-project.org/CRAN/refmans/terra/html/focal.html" class="external-link">terra::focal</a>
and <a href="https://search.r-project.org/CRAN/refmans/terra/html/focalPairs.html" class="external-link">terra::focalPairs</a>
functions.</p>
<p>The full references of the two articles by Gaucherel and colleagues
follow:</p>
<ul>
<li><p>Gaucherel, C. (2007) Multiscale heterogeneity map and associated
scaling profile for landscape analysis, <em>Landscape and Urban
Planning</em> 82(3) 95-102. doi:
10.1016/j.landurbplan.2007.01.022</p></li>
<li><p>Gaucherel, C., Alleaume, S. and Hély, C. (2008) The Comparison
Map Profile method: a strategy for multiscale comparison of quantitative
and qualitative images. <em>IEEE Transactions on Geoscience and Remote
Sensing</em> 46 (9): 2708-2719 doi: 10.1109/TGRS.2008.919379</p></li>
</ul>
<p>Package name is also a tribute to the work of <a href="https://en.wikipedia.org/wiki/Alphonse_Mucha" class="external-link">Alfons
Mucha</a>.</p>
</div>
<div class="section level2">
<h2 id="install-and-load-mucha">Install and load <code>mucha</code><a class="anchor" aria-label="anchor" href="#install-and-load-mucha"></a>
</h2>
<div class="section level3">
<h3 id="get-it">Get it<a class="anchor" aria-label="anchor" href="#get-it"></a>
</h3>
<p>You can install the last released version on CRAN straight for R
console with with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mucha"</span><span class="op">)</span></span></code></pre></div>
<p>If you prefer to work with the very last (development) version you
can install it with <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"vbonhomme/mucha"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-it">Load it<a class="anchor" aria-label="anchor" href="#load-it"></a>
</h3>
<p>Then, you can load <code>mucha</code> and <code>terra</code>
packages. <code>terra</code> is optional but you are very likely to need
it anyway.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vbonhomme/mucha" class="external-link">mucha</a></span><span class="op">)</span>   </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.80</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="online-manual">Online manual<a class="anchor" aria-label="anchor" href="#online-manual"></a>
</h3>
<ul>
<li><p>The package documentation, produced by pkgdown in available on
package’s homepage: <a href="https://vbonhomme.github.io/mucha" class="uri">https://vbonhomme.github.io/mucha</a></p></li>
<li><p>Issues, bug reports, feature request, etc. can be made at <a href="https://github.com/vbonhomme/mucha" class="external-link uri">https://github.com/vbonhomme/mucha</a>.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="mhm-and-cmp-speed-dating">MHM and CMP speed dating<a class="anchor" aria-label="anchor" href="#mhm-and-cmp-speed-dating"></a>
</h2>
<p>plop</p>
</div>
<div class="section level2">
<h2 id="import-and-prepare-data">Import and prepare data<a class="anchor" aria-label="anchor" href="#import-and-prepare-data"></a>
</h2>
<div class="section level3">
<h3 id="from-images">From images<a class="anchor" aria-label="anchor" href="#from-images"></a>
</h3>
<p><code>import_raster</code> can be used to import any image format
into <code>mucha</code>. More largely, any <code>SpatRaster()</code>,
for example obtained with <code>rast</code> function in terra.</p>
<p>We recommend using <code>.tif</code> for source images and not
compressed formats like <code>.jpg</code> that are very likely to
produce artifacts even at the highest quality.</p>
</div>
<div class="section level3">
<h3 id="from-text-formats">From text formats<a class="anchor" aria-label="anchor" href="#from-text-formats"></a>
</h3>
<p>If your raster is saved as a <code>.txt</code> (or equivalent such as
<code>.csv</code> ,etc.) you can also use <code><a href="../reference/import_txt.html">import_txt()</a></code>
which is a thin wrapper on top of <code>read.table</code>.</p>
<p>More generally, <code><a href="../reference/MHM.html">MHM()</a></code> and <code><a href="../reference/CMP.html">CMP()</a></code> functions
will accept any raster as <code>SpatRaster</code> (see above). If this
is not the case, try to use <code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast()</a></code> on it.</p>
</div>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>Some example landscapes are bundled with the package and can be
imported with <code><a href="../reference/import_example.html">import_example()</a></code>.</p>
<p>The full list of examples is available when passing the latter with
no argument (<code><a href="../reference/import_example.html">import_example()</a></code>. Once you made your choice,
you can import it with its name.</p>
<p>We will continue with these examples for portability purposes but
everything shown here should be available with your own images.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/import_example.html">import_example</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># all example files</span></span>
<span><span class="co">#&gt; Available example files to call with import_example('one_of_those_below'):</span></span>
<span><span class="co">#&gt; l1.tif</span></span>
<span><span class="co">#&gt; l1.txt</span></span>
<span><span class="co">#&gt; l2.tif</span></span>
<span><span class="co">#&gt; l2.txt</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_example.html">import_example</a></span><span class="op">(</span><span class="st">"l1.tif"</span><span class="op">)</span></span>
<span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/raster_helpers.html">raster_summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt;&gt;&gt; [801x600] raster (likely categorical)</span></span>
<span><span class="co">#&gt; &gt;&gt;&gt; with following (9) classes: 1, 4, 9, 11, 12, 13, 14, 15, 16</span></span>
<span><span class="co">#&gt; &gt;&gt;&gt; 349850 NA (72.8%) among 480600 values</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raster-preparation">Raster preparation<a class="anchor" aria-label="anchor" href="#raster-preparation"></a>
</h3>
<div class="section level4">
<h4 id="p-to-plot-your-landscapes">
<code>p()</code> to plot your landscape(s)<a class="anchor" aria-label="anchor" href="#p-to-plot-your-landscapes"></a>
</h4>
<p>All raster operations allowed by <code>terra</code> can be done on
your own raster since <code>mucha</code> uses nothing much than
<code>SpatRaster</code> class.</p>
<p>For example, you can use a <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot()</a></code> to visualize your
raster but the built-in <code><a href="../reference/p.html">p()</a></code> function is better suited for
our needs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/p-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Geyser"</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/p-2.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"RdYlGn"</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/p-3.png" class="r-plt" width="700"></p>
<p>For palette enthusiasts, the full list is available there:
<code><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.pals()</a></code>. Any vector of colors is also accepted.</p>
</div>
<div class="section level4">
<h4 id="qualitative-versus-continuous-raster">qualitative versus continuous raster<a class="anchor" aria-label="anchor" href="#qualitative-versus-continuous-raster"></a>
</h4>
<p>Depending on the nature of your layers, they may be by nature
categorical/qualitative (for example land occupations) or
continuous/quantitative (digital elevation map, rainfall records,
etc.)</p>
<p>Should you want to explicitly declare qualitative layers as factors,
you can use <code>raster_reclare_classes</code> to turn your values into
<code>factor</code>, with an optionnal <code>data.frame</code> as
follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># enforce qualitative</span></span>
<span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">raster_declare_classes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for an explicit declaration with class names</span></span>
<span><span class="co"># we will build a data.frame</span></span>
<span><span class="co"># first extract all values</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">values</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># and their correspondance (dummy)</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shrub"</span>, <span class="st">"corn"</span>, <span class="st">"habitations"</span>, <span class="st">"forest1"</span>, <span class="st">"forest2"</span>, <span class="st">"forest3"</span>, <span class="st">"cereal1"</span>, <span class="st">"cereal2"</span>, <span class="st">"cereal3"</span><span class="op">)</span></span>
<span><span class="co"># build the data.frame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value<span class="op">=</span><span class="va">values</span>, label<span class="op">=</span><span class="va">labels</span><span class="op">)</span></span>
<span><span class="co"># and now</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">raster_declare_classes</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span></span></code></pre></div>
<p>A nice side-effect is to have a better plot now. That you can push
further with a dedicated color scheme that can be passed to
<code>p</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># a nice land occupation color scheme</span></span>
<span><span class="va">land_occupations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"gold"</span>, <span class="st">"orange"</span>,</span>
<span>                      <span class="st">"palegreen"</span>, <span class="st">"palegreen2"</span>, <span class="st">"palegreen3"</span>,</span>
<span>                      <span class="st">"slateblue"</span>, <span class="st">"slateblue4"</span>, <span class="st">"slategray"</span><span class="op">)</span></span>
<span><span class="co">#' and now a nice plot we have</span></span>
<span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span>palette<span class="op">=</span><span class="va">land_occupations</span><span class="op">)</span></span></code></pre></div>
<p>For those not familiar with the forward pipe <code>%&gt;%</code> (or
<code>|&gt;</code>), that may get confused with the use of one or the
other syntax, let’s just say that <code>p(x)</code> is equivalent to
<code>x %&gt;% p()</code>. When more than a single function is called,
it helps defining more readable pipes. Read <code><a href="https://rdrr.io/r/base/pipeOp.html" class="external-link">?pipeOp</a></code>` for
more informations.</p>
</div>
<div class="section level4">
<h4 id="minify-your-landscape-to-speed-up-calculations">Minify your landscape to speed up calculations<a class="anchor" aria-label="anchor" href="#minify-your-landscape-to-speed-up-calculations"></a>
</h4>
<p>One very useful function is <code><a href="../reference/raster_helpers.html">raster_resample()</a></code>. Given
<code><a href="../reference/MHM.html">MHM()</a></code> and <code><a href="../reference/CMP.html">CMP()</a></code> imply huuuuge calculations, a
nice approach can be to setup and try/error your analyses with a
minified version of your landscape(s), then run the final one on the
pristine full res version.</p>
<p>That’s exactly what we will do here, to speed up calculations. Note
that below we exemplify how to use different color palette in
<code><a href="../reference/p.html">p()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see hcl.pals() for a full list of palettes</span></span>
<span><span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/raster_helpers.html">raster_resample</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Earth"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="intro_files/figure-html/raster_resample-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level4">
<h4 id="other-raster-helpers">Other raster helpers<a class="anchor" aria-label="anchor" href="#other-raster-helpers"></a>
</h4>
<p>More generally, all <code>raster_*</code> functions implement common
basic manipulations on rasters. See <code><a href="../reference/raster_helpers.html">?raster_helpers</a></code>.</p>
<p>For example, to explicitly declare your <code>NA</code>s, use
<code><a href="../reference/raster_helpers.html">raster_declareNA()</a></code>.</p>
<p>Some other examples:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/raster_helpers.html">raster_likely_categorical</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span> <span class="co"># a non perfect heuristic based on the number of classes. See ?cats</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/raster_helpers.html">raster_classes</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span> <span class="co"># class names. again to declare name explicitly, see ?cats</span></span>
<span><span class="co">#&gt; [1] "1"  "4"  "9"  "11" "12" "13" "14" "15" "16"</span></span></code></pre></div>
<p>As stated before, you can use <code>terra</code> functions and/or
combine with <code>mucha</code>’s ones:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span> <span class="co"># extract all pixel values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># class percentages for non NA pixels</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      1      4      9     11     12     13     14     15     16 </span></span>
<span><span class="co">#&gt; 17.800 10.200  0.699  2.780 11.100 26.900 18.000 10.600  1.920</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mhm-multiscale-statistics-on-a-single-landscape">MHM: multiscale statistics on a single landscape<a class="anchor" aria-label="anchor" href="#mhm-multiscale-statistics-on-a-single-landscape"></a>
</h2>
<div class="section level3">
<h3 id="base-usage">Base usage<a class="anchor" aria-label="anchor" href="#base-usage"></a>
</h3>
<p>Vanilla <code><a href="../reference/MHM.html">MHM()</a></code> runs with candid default values (see
<code><a href="../reference/MHM.html">?MHM</a></code>):</p>
<ul>
<li>focal <code>fun</code>ction is <code>mean</code>
</li>
<li>
<code>window</code> is <code>c(3, 13, 23)</code>
</li>
<li>with a circular <code>kernel</code>
</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op">&lt;-</span> <span class="va">l1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/MHM.html">MHM</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em><code>fun</code></em> can be passed with any function returning a
scalar, ie a numeric of length 1, ie a single value. See
<code><a href="../reference/mhm_funs.html">?mhm_funs</a></code> for <code>richness</code>, <code>simpson</code>
and <code>shannon</code> indices, etc. and also <code>contagion</code>
and <code>kappa_index</code> for categorical landscapes.</p>
<p><em><code>window</code></em> must only contain odd numbers.
<code>odd_floor</code> is your friend to do so.
<code>window_broad</code> and <code>window_linearpixels</code> are
helpers to obtain (often) interesting window size range.</p>
<p>*<code>kernel</code> can be passed with one of <code>kernel</code>
function (ie to have square, gaussian, etc.). With
<code>kernel_gaussian</code>, only <code>sum</code> is allowed by
<code>terra</code>.</p>
<p>Let’s change a bit default values to i) change the window range and
ii) use richness (ie count the number of classes). Before that, we
resample so that calculations are not too long while we’re still tuning
our analyses.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_lite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/raster_helpers.html">raster_resample</a></span><span class="op">(</span><span class="va">l1</span>, width <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/window.html">window_linearpixels</a></span><span class="op">(</span><span class="va">l1_lite</span>, steps <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">l1_mhm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MHM.html">MHM</a></span><span class="op">(</span><span class="va">l1_lite</span>, </span>
<span>              fun<span class="op">=</span><span class="va">richness</span>,  </span>
<span>              window <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="monoscale-maps-multiscale-map-and-profile-plot">Monoscale maps, multiscale map and profile plot<a class="anchor" aria-label="anchor" href="#monoscale-maps-multiscale-map-and-profile-plot"></a>
</h3>
<p>The object you obtain is also a <code>SpatRaster</code> on which you
can access particular layers with say <code>l1_mhm[[2]]</code>. But it
is probably more interesting to have a look to all <strong>monoscale
maps</strong> at once:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/mhm_calc1_summ-1.png" class="r-plt" width="700"></p>
<p>You can all apply one more function accross all layers and calculate
a composite map, aka a <em>multiscale map</em>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/mhm_calc1_summ2-1.png" class="r-plt" width="700"></p>
<p>At this step, a geometric mean exacerbates the gradients:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">gmean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/mhm_calc1_summ3-1.png" class="r-plt" width="700"></p>
<p>You can calculate the profile plot and calculate a global summary
using two functions per window size and plot it.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/ms_profile.html">ms_profile</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># mean ± SD by default</span></span></code></pre></div>
<p><img src="intro_files/figure-html/mhm_calc1_summ4-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l1_mhm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/ms_profile.html">ms_profile</a></span><span class="op">(</span>summary_fun<span class="op">=</span><span class="va">median</span>, error_fun <span class="op">=</span> <span class="va">sd</span>, ylab<span class="op">=</span><span class="st">"median ± sd"</span><span class="op">)</span> <span class="co"># mean ± SD by default</span></span></code></pre></div>
<p><img src="intro_files/figure-html/mhm_calc1_summ4-2.png" class="r-plt" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="cmp-multiscale-statistics-on-a-pair-of-rasters">CMP: multiscale statistics on a pair of rasters<a class="anchor" aria-label="anchor" href="#cmp-multiscale-statistics-on-a-pair-of-rasters"></a>
</h2>
<p>CMP works almost exactly the same except that it uses two landscapes
and consequently uses appropriate (and other) functions (See
<code><a href="../reference/cmp_funs.html">?cmp_funs</a></code>).</p>
<p>That being said, what follows should sound familiar.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's iport the two example rasters from CMP paper</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_example.html">import_example</a></span><span class="op">(</span><span class="st">"l1.tif"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/raster_helpers.html">raster_resample</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_example.html">import_example</a></span><span class="op">(</span><span class="st">"l2.tif"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/raster_helpers.html">raster_resample</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let's plot them</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/cmp_import-1.png" class="r-plt" width="700"></p>
<p>Now we will calculate CMP using a bare correlation.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l12_cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CMP.html">CMP</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span>, fun<span class="op">=</span><span class="va">dist_euclidean</span><span class="op">)</span></span></code></pre></div>
<p>And again, show the different summaries starting with the monoscale
maps, then the profile plot and finally the multiscale map:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l12_cmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/cmp_summ-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l12_cmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/ms_profile.html">ms_profile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/cmp_summ-2.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l12_cmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/p.html">p</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/cmp_summ-3.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="export-results">Export results<a class="anchor" aria-label="anchor" href="#export-results"></a>
</h2>
<p>Have a look to <code>export_image</code> and <code>export_txt</code>
functions.</p>
<p>Otherwise follow <code>terra</code> guidelines for manipulation the
stack of monoscales layers.</p>
</div>
<div class="section level2">
<h2 id="going-further">Going further<a class="anchor" aria-label="anchor" href="#going-further"></a>
</h2>
<div class="section level3">
<h3 id="can-i-use-custom-functions-for-mhm-and-cmp">Can I use custom functions for MHM and CMP?<a class="anchor" aria-label="anchor" href="#can-i-use-custom-functions-for-mhm-and-cmp"></a>
</h3>
<p>Yes, have a look to function definitions, eg <code>shannon</code> or
<code>cor_pearson</code> (no parentheses to access function definition)
and mimic it. For both <code>MHM</code> and <code>CMP</code>, do not
forget <code>...</code> as an argument. For <code>CMP</code>, think of
declaring <code>x</code> <em>and</em> <code>y</code> as arguments.</p>
</div>
<div class="section level3">
<h3 id="can-i-write-my-own-ms_profile-function-eg-in-ggplot2">Can I write my own <code>ms_profile</code> function, eg in
ggplot2?<a class="anchor" aria-label="anchor" href="#can-i-write-my-own-ms_profile-function-eg-in-ggplot2"></a>
</h3>
<p>Sure, and <code>ms_profile_df</code> may help to do so.</p>
<hr>
<p>Should you have any idea, suggestions, etc. feel free to contact me:
<a href="mailto:bonhomme.vincent@gmail.com" class="email">bonhomme.vincent@gmail.com</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vincent Bonhomme, Cedric Gaucherel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
